# =====================================================
# GitHub Actions Workflow for Netlify Deployment
# =====================================================
# This workflow automatically deploys changes to Netlify when you push to main branch
# Note: This is optional - Netlify will auto-deploy via webhook even without this

name: Deploy to Netlify

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      # Checkout code
      - uses: actions/checkout@v3
      
      # Install dependencies (optional - this is a static site)
      - name: Install dependencies
        run: npm install --legacy-peer-deps || true
      
      # Build (optional - static site doesn't need building)
      - name: Build
        run: npm run build || true
      
      # Deploy to Netlify
      - name: Deploy to Netlify
        uses: nwtgck/actions-netlify@v2.0
        with:
          publish-dir: './public'
          production-branch: main
          # TODO: Add gh token to secrets manager
          github-token: ${{ secrets.GITHUB_TOKEN }}
          deploy-message: 'Deploy from GitHub Actions'
          enable-pull-request-comment: true
          enable-commit-comment: true
          overwrites-pull-request-comment: true
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
        timeout-minutes: 1

  # =====================================================
  # HTML/CSS/JS Validation
  # =====================================================
  
  validate:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Validate HTML
        run: |
          echo "✓ HTML validation would run here"
          echo "  (Install html-validate globally for real validation)"
      
      - name: Check for required files
        run: |
          echo "Checking critical files..."
          test -f "index.html" && echo "✓ index.html exists" || exit 1
          test -f "netlify.toml" && echo "✓ netlify.toml exists" || exit 1
          test -f "css/main.css" && echo "✓ css/main.css exists" || exit 1
          test -f "js/forms.js" && echo "✓ js/forms.js exists" || exit 1
          echo "All critical files present!"
